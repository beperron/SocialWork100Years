---
title: 'Examining a Quarter Century of Publishing Trends in Social Work Research:
  A Data Science Perspective'
author: ''
date: "May 26, 2015"
output: pdf_document
header-includes:
- \usepackage{indentfirst}
- \usepackage{setspace}
- \doublespacing
- \setlength{\parindent}{4em}
---


`r knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, comment=NA)`

```{r colorThemes}
# http://colorbrewer2.org/?type=diverging&scheme=PuOr&n=4

cp <- c("#fdb864", "#e66101", "#b2abd2", "#5e3c99" )
```

```{r objectMakerProQuest, warning=FALSE, message=FALSE, eval=FALSE, results='hide', cache=TRUE}
# Clear workspace
rm(list=ls())

# Read BWR functions for Mac OS
source("/Users/beperron/Git/BibWrangleR/functions/proquestBWR.R")

# Set the path where original raw data are stored
setwd("/Users/beperron/Git/SocialWorkResearch/Data")

# Set the working directory to store files created by BWR functions
path <- "/Users/beperron/Git/SocialWorkResearch/Data/ProQuest"

# Wrangle the data with the BWR function suite

proQuestBWR.f(csv=FALSE, path=path)
save(proQuestBWR.df, file = "ProQuest.R")
```

```{r objectMakerEbscoHost,warning=FALSE, message=FALSE, eval=FALSE, results='hide', cache=TRUE}
# Clear workspace
rm(list=ls())

# Read BWR functions for Mac OS
source("/Users/beperron/Git/BibWrangleR/functions/ebscoBWR.R")

# Set the path where original raw data are stored
setwd("/Users/beperron/Git/SocialWorkResearch/Data")

# Set the working directory to store files created by BWR functions
path <- "/Users/beperron/Git/SocialWorkResearch/Data/ebscoFULL"

# Wrangle the data with the BWR function suite

ebscoBWR.f(csv=FALSE, path=path)
save(ebscoBWR.df, file = "ebscoFULL.R")
```

```{r BEPinitialization, eval=TRUE}
rm(list=ls())  

#load("/Users/beperron/Git/SocialWorkResearch/socialWorkHistory.Rdata")

#Load required packages
library(ggplot2)
library(dplyr)
library(gridExtra)
```

```{r BGVinitialization, eval=FALSE}
rm(list=ls())  
load("/Users/SSW/Documents/GitHub/SocialWork100Years/socialWorkHistory.Rdata")

# Load required packages
library(ggplot2)
library(dplyr)
library(gridExtra)
```

```{r cleaningFunctions, comment=NA, echo=FALSE, eval=TRUE, cache=TRUE}
# Read data files
options(stringsAsFactors = FALSE)
load("/Users/beperron/Git/SocialWorkResearch/Data/ebscoFULL.R")
load("/Users/beperron/Git/SocialWorkResearch/Data/proQuest.R")
hodge <- readLines("/Users/beperron/Git/SocialWorkResearch/search_specifications/hodge.txt", n = -1)

source("/Users/beperron/Git/SocialWorkResearch/functions/combineData.R")
source("/Users/beperron/Git/SocialWorkResearch/functions/cleaningJournals.R")
source("/Users/beperron/Git/SocialWorkResearch/functions/shortArticlesRevised.R")
source("/Users/beperron/Git/SocialWorkResearch/functions/titleMatching.R")
source("/Users/beperron/Git/SocialWorkResearch/functions/otherDocuments.R")
source("/Users/beperron/Git/SocialWorkResearch/functions/fewArticles.R")
source("/Users/beperron/Git/SocialWorkResearch/functions/pretty.R")

combineData.f()
cleaningJournals.f()
shortArticles.f()
titleMatching.f()
otherDocuments.f()
fewArticles.f()
#save.image(file = "socialWorkHistory.Rdata")
```

```{r summarySetUp, eval=TRUE, cache=TRUE}
unique.titles <- filter(full.df, attributes == "journal") %>%
    group_by(record) %>%
    summarise(N = n())

articles.titleMatching <- length(which(full.df$attributes == "article"))

journals.titleMatching <- filter(full.df, attributes == "journal") %>%
    summarise(Unique = n_distinct(record))

articles.otherDocuments <- length(which(full.df$attributes == "article"))

journals.otherDocuments <- filter(full.df, attributes == "journal") %>% 
    summarise(Unique = n_distinct(record))

articles.final <- length(which(full.df$attributes == "article"))

journals.final <- filter(full.df, attributes == "journal") %>% 
    summarise(Unique = n_distinct(record))

unique.titles <- filter(full.df, attributes == "journal") %>%
    group_by(record) %>%
    mutate(Hodge.list = ifelse(record %in% hodge == TRUE, 1, 0)) %>%
    summarise(N = n(), Hodge.list = max(Hodge.list)) %>%
    mutate(Hodge = ifelse(Hodge.list == 1, "Y", "N"))

n.so.yr <- filter(full.df, attributes == "journal" | attributes == "pubYear")

n.so <- filter(full.df, attributes == "journal") %>% mutate(title = record) %>% 
    select(-attributes, -record)

n.yr <- filter(full.df, attributes == "pubYear") %>% mutate(year = record ) %>% 
    select(-attributes, -record)
```

```{r  plot01_JournalsArticles, cache=TRUE}
cp <- c("#fdb864", "#e66101", "#b2abd2", "#5e3c99" )

#=======================================
# Journals
#=======================================
library(gridExtra)

n.journals.year <- filter(full.df, attributes == "journal") %>%
    select(articleID, record)

n.year <- filter(full.df, attributes == "pubYear") %>%
    select(articleID, record)

n.journals.year <- left_join(n.journals.year, n.year, by = "articleID", copy=TRUE) %>%
    group_by(record.y) %>%
    summarise(Journal.count = n_distinct(record.x)) %>%
    mutate(record.y = as.numeric(record.y))

plot.journal.count <- ggplot(n.journals.year, aes(record.y, 
    y = Journal.count, group=1)) + 
    theme_bw() + 
    geom_line(colour=cp[4], size = 1, alpha = .80) +
    theme(axis.text.x = element_text(size=8), 
    title = element_text(size = 10), plot.title=element_text(size=10)) + 
    xlab("Year") + 
    ylab("Journals") + 
    scale_y_continuous(breaks = c(seq(0, 100, 5)), limits = c(20, 70)) +
    scale_x_continuous(breaks=seq(1989, 2015, 8)) +
    theme(axis.title.x = element_text(vjust=-0.5), axis.title.y = element_text(vjust=.75))

#=======================================
# Articles
#=======================================

articles.df <- left_join(n.so, n.yr) %>%
    group_by(year) %>%
    summarize(N = n()) %>%
    mutate(year = as.numeric(year), CumSum = cumsum(N)) %>%
    ungroup() %>%
    arrange(desc(N), year) %>%
    rename(Year = year) 


plot.article.count <- ggplot(articles.df, aes(Year, N, group =1)) + 
    theme_bw() + 
    geom_line(colour=cp[2], size = 1, alpha=.80) +
    theme(axis.text.x = element_text(size=8), 
    title = element_text(size = 10), plot.title=element_text(size=10)) + 
    xlab("Year") + 
    ylab("Articles") + 
    scale_x_continuous(breaks=seq(1989, 2015, 8)) +
    scale_y_continuous(breaks = c(seq(0, 2200, 250)), limits= c(500, 2100)) +
    theme(axis.title.x = element_text(vjust=-0.5), axis.title.y = element_text(vjust=.75))
```

```{r plot02_SmallMultiples, cache=TRUE}
# Remove 2014 & 2015 

# Create an initial data frame from HD
sm.df <- left_join(n.so, n.yr) %>%
    group_by(title, year) %>%
    summarize(N = n()) %>%
    mutate(Overall.N = sum(N), year = as.numeric(year)) %>%
    ungroup() %>%
    arrange(desc(Overall.N), title) %>%
    rename(Year = year, Journal= title) 

# Read Scopus database
scopus.df <- read.csv("/Users/beperron/Git/SocialWorkResearch/Data/scopus.csv")
scopus.df2 <- read.csv("/Users/beperron/Git/SocialWorkResearch/Data/scopus_OldHarvest.csv")


scopus.df$Year <- as.numeric(scopus.df$Year)
scopus.df <- filter(scopus.df, Year <= 2013)

# Join HD with Scopus and join abbreviation names
sm.scopus.merged <-full_join(sm.df, scopus.df, by = c("Journal", "Year")) %>%
    select(Year, Journal, N, Overall.N, Documents)




 sm.scopus.merged.table <- group_by(sm.scopus.merged, Journal) %>%
     summarize(DataBase.N = sum(N, na.rm=TRUE), Scopus.N = sum(Documents, na.rm=TRUE)) %>%
     arrange(desc(DataBase.N))


 abb <- read.csv("/Users/beperron/Git/SocialWorkResearch/Data/master.csv")
 abb$ID <- 1:nrow(abb)
 sm.scopus.merged <- full_join(sm.scopus.merged, abb, by = "Journal") %>% 
     select(-X) %>%
     mutate(Documents = ifelse(Documents == 0, NA, Documents))
 
 
 # Re-order the factor by Overall.N
 title <- sm.scopus.merged %>% arrange(desc(Overall.N)) %>% 
     distinct(Abbrev) %>% filter(!is.na(Abbrev)) %>% distinct()
 
 title.order = title$Abbrev
 
 sm.scopus.merged$Abbrev <- factor(sm.scopus.merged$Abbrev, levels = (title.order))
 sm.scopus.merged <- group_by(sm.scopus.merged, Journal) %>%
     mutate(Overall.Scopus = sum(Documents, na.rm=TRUE)) %>%
     ungroup()
# 
 # Create labels for the facets
 Overall.N <- distinct(sm.scopus.merged, Abbrev) 
 lab1 <- gsub(" ", "", paste("N=", pretty(Overall.N$Overall.N), sep=""))
 lab2 <- gsub(" ", "", paste("N=", pretty(Overall.N$Overall.Scopus), sep=""))
 lab <- paste(lab1, lab2, sep="\n")
 xpos = rep(1999, 79)
 ypos = rep(200, 79)
 ldata <- data.frame(xpos, ypos, lab, Overall.N$Abbrev) %>% 
     rename(Abbrev = Overall.N.Abbrev) 
 
 ldata <- na.omit(ldata)
 
 
 titles.reduced <- unique(sm.scopus.merged$Journal)
 titles.reduced.1 <- titles.reduced[1:40]
 titles.reduced.2 <- titles.reduced[41:length(titles.reduced)] 
 cp <- c("#fdb864", "#e66101", "#b2abd2", "#5e3c99" )
 
 library(grid)
 library(gridExtra)
# Plotting function    
# 
 plotSmallMultiples.1 <-  ggplot(sm.scopus.merged[sm.scopus.merged$Journal %in% titles.reduced.1, ],  aes(Year, N)) +
     geom_line(colour="#e66101") +
     geom_line(data = sm.scopus.merged[sm.scopus.merged$Journal %in% titles.reduced.1, ], aes(Year, Documents), colour = "#533c99", alpha = .80) + 
     facet_wrap(~ Abbrev) + 
     theme_bw() +
     theme(strip.text.x = element_text(size = 8)) + 
     theme(legend.position = "bottom", 
     panel.grid.minor = element_blank(), 
     axis.text.x = element_text(angle=45, hjust=1, size =8)) + 
     geom_text(data = ldata[1:40, ], aes(x =xpos, y = ypos, label = lab), size =2.5) +
     ylim(c(0,225)) +
     scale_x_continuous(breaks=seq(1989, 2015, 8)) +
     annotate("segment", x = 1989, xend = 1992, y = 215, yend = 215, colour = "#e66101") + 
     annotate("segment", x = 1989, xend = 1992, y = 190, yend = 190, colour = "#533c99")

plotSmallMultiples.2 <- ggplot(sm.scopus.merged[sm.scopus.merged$Journal %in% titles.reduced.2, ],  
     aes(Year, N)) +
     geom_line(colour="#e66101") +
     geom_line(data = sm.scopus.merged[sm.scopus.merged$Journal %in% titles.reduced.2, ], 
     aes(Year, Documents), colour = "#533c99", alpha = .80) + 
     facet_wrap(~ Abbrev) + 
     theme_bw() +
     theme(strip.text.x = element_text(size = 8)) +  
     theme(legend.position = "bottom", 
     panel.grid.minor = element_blank(), 
     axis.text.x = element_text(angle=45, hjust=1, size =8)) + 
     geom_text(data = ldata[41:79, ], aes(x =xpos, y = ypos, label = lab), size =2.5) +
     ylim(c(0,225)) +
     scale_x_continuous(breaks=seq(1989, 2015, 8)) +
     annotate("segment", x = 1989, xend = 1992, y = 215, yend = 215, colour = "#e66101") + 
     annotate("segment", x = 1989, xend = 1992, y = 190, yend = 190, colour = "#533c99")
```

```{r plot03_AuthorPages, eval=TRUE, cache=FALSE}

#----------------------------
#Authors
#----------------------------


year.df <- full.df %>%
    filter(attributes == "pubYear") %>%
    select(id = articleID, pubYear = record)

authors.df <- full.df %>%
    filter(attributes == "author") %>%
    select(id = articleID, author = record)

n_authors <- authors.df %>%
    group_by(id) %>%
    summarise(n=n())

n_authors <- n_authors%>% 
    left_join(year.df) %>%
    group_by(pubYear) %>%
    mutate(n = as.numeric(n)) %>%
    summarise(median.n = median(n),
        average.n = mean(n),
        min.n = min(n),
        max.n = max(n),
        std.dev  = sd(n) )

n_authors2 <- n_authors%>% 
   select(median.n, average.n, std.dev) %>%
   rename(Median = median.n, Average = average.n, Standard_Deviation =std.dev)


n_authors2$year <- c(1989:2013)


cp <- c("#fdb864", "#e66101", "#b2abd2", "#5e3c99" )

n_authors2.melted <- reshape2::melt(n_authors2, id.vars = c("year", "Standard_Deviation"))
n_authors3.melted <- filter(n_authors2.melted, variable == "Average")

plot.author.count <- ggplot(n_authors2.melted, aes(x = year, y = value, group=variable, colour = variable)) + 
    theme_bw() + 
    geom_line() +
    geom_point(data = n_authors3.melted, aes(size = Standard_Deviation), colour = "#e66101", alpha=.60) + 
    #theme(axis.text.x = element_text(angle = 45, hjust = 1), 
    #title = element_text(size = 10)) +  
    scale_x_continuous(breaks=c(seq(1989, 2013, 4))) +
    scale_y_continuous(limits = c(.75,2.5)) +
    ylab("Number of Authors") +
    xlab("") +
    labs(size = "SD = ") +
    labs(colour = NULL) + 
    scale_colour_manual(values = c("#fdb864", "#e66101")) +
    theme(axis.title.x = element_text(vjust=-0.5), 
          axis.title.y = element_text(vjust=.75), 
          legend.position = "bottom") + 
       theme(title = element_text(size = 10)) +
    theme(axis.text.x = element_text(size=8), 
    title = element_text(size = 10), plot.title=element_text(size=10)) +
    theme(legend.text = element_text(size = 8), legend.title = element_text(face="plain"))

#----------------------------
#Pages
#----------------------------



cp <- c("#fdb864", "#e66101", "#b2abd2", "#5e3c99" )
pages.tmp <- full.df %>% filter(attributes == "pages")
years.tmp <- full.df %>% filter(attributes == "pubYear")
pages.df <- left_join(pages.tmp, years.tmp, by = "articleID") %>% 
    select(record.y, record.x) %>%
    rename(years = record.y, pages = record.x) %>%
    mutate(pages = as.numeric(pages), years = as.numeric(years)) %>%
    group_by(years) %>%
    summarise(
        Median = median(pages, na.rm=TRUE), 
        Average = mean(pages, na.rm=TRUE),
        Std.Pages = sd(pages, na.rm=TRUE))



pages.df$years <- c(1989:2013)

pages.df.melted <- reshape2::melt(pages.df, id.vars = c("years", "Std.Pages"))

pages.df2.melted <- filter(pages.df.melted, variable == "Average")

page.plot <- ggplot(pages.df.melted, aes(x = years, y = value, group=variable, colour = variable)) + 
    geom_line() +
    geom_point(data = pages.df2.melted, aes(size = Std.Pages), colour = "#5e3c99", alpha = .60) + 
    theme_bw() + 
    theme(title = element_text(size = 10)) +  
    scale_x_continuous(breaks=c(seq(1989, 2013, 4))) +
    ylab("Number of Pages") +
    xlab("") +
    labs(size = "SD = ") +
     labs(colour = NULL) +   
    scale_colour_manual(values = c("#b2abd2", "#5e3c99"))  +
    theme(axis.title.x = element_text(vjust=-0.5), axis.title.y = element_text(vjust=.75), 
          legend.position = "bottom") +
    theme(axis.text.x = element_text(size=8), 
    title = element_text(size = 10), plot.title=element_text(size=10)) +
    theme(legend.text = element_text(size = 8), legend.title = element_text(face="plain"))

```

```{r plot04_EBPstacked, cache=FALSE}
abstract.df <- filter(full.df, attributes == "abstract")
year.df <- filter(full.df, attributes == "pubYear")
journal.df <- filter(full.df, attributes == "journal")
abstract.df <- left_join(year.df, abstract.df, by = "articleID")
abstract.df <- left_join(abstract.df, journal.df, by = "articleID")
abstract.df <- abstract.df %>% select(-attributes.x, -attributes.y, -attributes)
colnames(abstract.df) <- c("articleID", "year", "abstract", "journal")
abstract.df$abstract <- gsub("[[:punct:]]", "", abstract.df$abstract)
abstract.df$abstract <- tolower(abstract.df$abstract)

ebp.df <- abstract.df[grep("evidence\\s?based\\spractices?|ebp|empirically\\s?supported\\streatments?", abstract.df$abstract), ]
ebp.df$studyType <- rep("ebp", nrow(ebp.df))

meta.df <- abstract.df[grep("meta\\s?analysis|metanalysis|systematic\\s?review|meta[-]analysis", abstract.df$abstract), ]
meta.df$studyType <- rep("meta", nrow(meta.df))

rct.df <- abstract.df[grep("randomi[s|z]ed.*trial|[^non]experimental\\sdesign|rct|controlled\\sclinical\\strial|cct", abstract.df$abstract), ]
rct.df$studyType <- rep("rct", nrow(rct.df))

#systematicReview.df <- abstract.df[grep("systematic\\s?review", abstract.df$abstract), ]
#systematicReview.df$studyType <- rep("sr", nrow(systematicReview.df))

quasi.df <- abstract.df[grep("cohort\\sstudy|case\\scontrol\\sstudy|quasi\\s?experimental|non\\s?experimental", abstract.df$abstract), ]
quasi.df$studyType <- rep("quasi", nrow(quasi.df))

evidence.df <- rbind(meta.df, rct.df, 
     quasi.df) 

evidence.df$studyType <- factor(evidence.df$studyType, labels= c("Meta-analysis,\nSystematic Review", "Quasi-experimental", "RCT"))

evidence.df$studyType <- factor(evidence.df$studyType, 
    levels(evidence.df$studyType)[c(1,3,2)])


evidence.summary <- select(evidence.df, -abstract) %>% 
    group_by(year, studyType) %>%
    summarize(N = n()) %>%
    group_by(studyType) %>%
  mutate(cumulative = cumsum(N))

cp <- c("#b2abd2", "#5e3c99", "#fdb864", "#e66101" )
evidence.summary <- ungroup(evidence.summary)
evidence.summary$year <- as.numeric(evidence.summary$year)
#evidence.summary$studyType <- as.factor(evidence.summary$studyType)

abstractsYear.df <- group_by(abstract.df, year) %>% 
    summarize(N.abstracts = n()) %>%
    mutate(year = as.numeric(year))

evidence.summary2 <- full_join(evidence.summary, abstractsYear.df, 
    by = "year") %>%
    mutate(studyProp =N / N.abstracts)

year.labs <- as.character(seq(1989,2013, 4))  

stacked.df <- as.data.frame(xtabs(N~year+studyType, evidence.summary))

stacked.plot <- ggplot(stacked.df, 
    aes(x = as.numeric(year), y = Freq, fill=studyType)) + 
    geom_area(alpha=.60, colour = "black", size = .2) +
    theme_bw() +
    scale_fill_manual(values=cp, 
        breaks = rev(levels(evidence.summary$studyType)))+
    scale_x_continuous(breaks = seq(0,24, 4), labels = year.labs) + 
    theme(  legend.position=c(.25,.80),
#         legend.background = element_blank(), 
         legend.key = element_blank()   ) + 
    ylab("Number of Articles") + 
    xlab("Year") + 
    labs(fill = "") +
    scale_y_continuous(breaks = seq(0,90, 10)) +
    theme(axis.title.x = element_text(vjust=-0.5), axis.title.y = element_text(vjust=.75)) +
    theme(axis.text.x = element_text(size=8), axis.text.y = element_text(size =8),
    title = element_text(size = 10), plot.title=element_text(size=10)) +
    theme(legend.text = element_text(size = 8))
```

```{r plot05_ProportionsLine, cache=FALSE}
df <- evidence.summary2

evidence.plot <- ggplot(na.omit(df), aes(year, studyProp, colour = studyType, 
    group = studyType), na.rm=TRUE) + 
    geom_smooth(aes(fill=studyType), alpha = .40, colour = "dimgray") + facet_wrap(~studyType) + 
    theme_bw() +
    scale_fill_manual(values = cp) +   
    scale_color_manual(values = cp) + 
    theme(legend.position = "none") + 
    ylab("Proportion") + 
    geom_point(colour = "black", alpha = .60) + 
    annotate("segment", x = 1989, y = 0, xend = 2013, yend = 0, alpha = .6, 
        linetype= "solid") +
    annotate("segment", x = 1989, y = 0, xend = 1989, yend = .0175, alpha = .6, 
        linetype = "solid") +
    annotate("segment", x = 2013, y = 0, xend = 2013, yend = .0175, alpha = .6,
             linetype = "solid") +
    scale_x_continuous(breaks = seq(1989, 2014, 4)) + 
     theme(axis.text.x = element_text(angle = 45, hjust = 1)) + 
    scale_y_continuous(breaks = seq(0, .03, .005)) +
    theme(axis.text.x = element_text(size=8), axis.text.y = element_text(size =8),
    title = element_text(size = 8), plot.title=element_text(size=8)) +
    theme(legend.text = element_text(size = 8))
``` 

```{r plot06_EBPjournal, cache=FALSE}
evidence.summary3 <- select(evidence.df, -abstract) %>% 
    group_by(journal, studyType) %>%
    summarize(N = n()) 

evidence.summaryOverall <- select(abstract.df, -abstract) %>%
    group_by(journal) %>%
    summarize(Overall.N = n())

evidence.journals <- full_join(evidence.summary3, evidence.summaryOverall, by = "journal") %>%
    mutate(JN.prop = N/Overall.N) %>% group_by(journal) %>%
    mutate(Overall.N.Strength = sum(N))
    
evidence.journalsOverall <- evidence.journals %>% group_by(journal) %>%
    mutate(Overall.N.Strength = sum(N))

df <-  select(evidence.journalsOverall, studyType, N, Overall.N.Strength) %>%
    rename(N.sort = Overall.N.Strength)

df1 <- df
pareto.df <- df1 %>% group_by(journal) %>% 
    summarize(EBP.counts = sum(N)) %>% 
    arrange(desc(EBP.counts)) %>%
    ungroup() %>%
    mutate(overallCount = sum(EBP.counts, na.rm=TRUE)) %>%
    mutate(percentTotal = (EBP.counts/overallCount) *100) %>%
    mutate(cumSum = cumsum(percentTotal)) %>%
    slice(1:16)
    
df1.reduced <- na.omit(df1[df1$journal %in% pareto.df$journal, ])
df1.reduced <- ungroup(df1.reduced)
df1.reduced <- full_join(df1.reduced, pareto.df, by = "journal")

abb <- rename(abb, journal = Journal) 
    
df1.reduced <- left_join(df1.reduced, abb, by = "journal")


j.order <- unique(df1.reduced$Abbrev[order(df1.reduced$N.sort, decreasing = FALSE)]) 

df1.reduced$Abbrev <- factor(df1.reduced$Abbrev, levels = j.order)


df1.unique <- group_by(df1.reduced, Abbrev) %>% slice(1)
df1.unique$journal <- factor(df1.unique$Abbrev, levels = j.order)

journal.evidence.plot <- ggplot(na.omit(df1.reduced), aes(x = Abbrev, y = N)) + 
    geom_bar(aes(fill = studyType), stat = "identity", alpha=.60) +
    coord_flip() +
    theme_bw() + 
    geom_text(data = df1.unique, aes(y = EBP.counts+7, x = Abbrev, label = EBP.counts), size = 2.5) +
    labs(x = "Journal", y = "N") +
    ylim(c(0, 150)) +
    scale_fill_manual(values = cp) +
    theme(legend.position = c(.65,.7),  legend.title=element_blank(), 
          legend.background = element_rect(fill="transparent")) +
    theme(axis.text.x = element_text(size=8), axis.text.y = element_text(size=8), 
    title = element_text(size = 10), plot.title=element_text(size=10)) +
    theme(legend.text = element_text(size = 8))
```

```{r plot07_EBPproportion, cache=FALSE}

proportionsEBP.df <- df1.reduced %>% 
    group_by(journal) %>% 
    slice(1) %>%
     mutate(Journal = as.character(journal)) %>%
    ungroup() %>%
    select(-studyType, -N, -N.sort, -journal, -overallCount, -percentTotal, -cumSum) 
   
proportionEBP2.df <- full_join(proportionsEBP.df, sm.scopus.merged.table, by = "Journal")  %>% 
    mutate(journalProp = EBP.counts / DataBase.N) %>%
    arrange(desc(journalProp)) 

proportionEBP3.df <- proportionEBP2.df[proportionEBP2.df$Journal %in% df1.reduced$journal, ]
proportionEBP3.df$Journal <- factor(proportionEBP3.df$Journal, levels = j.order)

options(digits=3)
proportionEBP3.df$journalProp <- round(proportionEBP3.df$journalProp, digits = 2)
propPlot <- ggplot(proportionEBP3.df, aes(journalProp, Abbrev)) +
    theme_bw() + 
    geom_point(colour="grey40") +
    geom_segment(aes(yend = Abbrev, xend = 0), colour = "grey40") + 
    theme(axis.text.y = element_blank(), axis.ticks = element_blank(), 
          legend.position = "none", 
          panel.grid.minor = element_blank(), 
            panel.margin = unit(0,"null")) + 
    ylab(NULL) +
    xlab("Proportion") +
    geom_text(aes(x = journalProp + .07, y = Abbrev, label = journalProp), size = 2.5) +
    xlim(c(0, .5))  +
    theme(axis.text.x = element_text(size=8),  
    title = element_text(size = 8), plot.title=element_text(size=8)) +
    theme(legend.text = element_text(size = 8))
```


```{r appendix_A_intersection}
unique.swHistory <- filter(full.df, attributes == "journal") %>%
    distinct(record)

hodge.swHistory.intersect <- intersect(hodge, unique.swHistory$record)

hodge.swHistory.diff <- setdiff(hodge, unique.swHistory$record)

```



# Methods

## Identification of social work journals 
 
The primary unit of analysis for this study was the bibliographic records of social
work journal articles (hereafter referred to as ``article records``).  The
first step in the extraction process involved constructing a comprehensive list
of social work journal titles.  We used the work of Hodge and Lacasse (2011) as
our base list.  Hodge and Lacasse (2011) compiled a list of 84 unique social
work journal titles using a variety of sources, includingt the book _An
Author’s Guide to Social Work Journals_ (NASW Press, 1997), Thyer’s (2005) more
recent listing of social work periodicals, and the website _Genamics
JournalSeek_ (http://journalseek.net/). Hodge and Lacasse (2011) examined the
mission and aims of each journal, and eliminated journals that were specific to
another field or had an inter-disciplinary focus.  All social work journals
identified by Hodge and Lacasse (2011) were included on our base list.  

To ensure comprehensive coverage, we supplemented our search by searching the Internet and bibliogpraphic databases that contained any of the following terms: 
 
 + "social work" 
 + "social welfare" 
 + "social casework" 
 + "social service"
 + "human  service" 
 + "social development" 
 + "social environment"

Journal titles that were identified with any of these terms were reviewed
by the study team to determine whether they should be included in the study. When disagreements occurred, the authors reviewed the
mission and aims of the journals, names of editorial board members, and content
of representative articles.  A consensus was reached on all journal titles to
be excluded and retained.  In this process, an additional XX journal were
identified, producing a final target list of XX journals.    

## Extraction of article records

After finalizing the target list of social work journals, we extracted article records from three major databases
on the EbscoHost platform (PsycINFO, Social Science Abstracts, and Social Work
Abstracts) and xx minor databases on ProQuest (e.g., ERIC, Sociological
Abstracts, Worldwide Political Science Abstracts).  Using the ``publication
source`` fields of the search interface, we searched for article records that
contained the names of each social work journal.  Searches were limited to a
quarter century time-frame, 1989 to 2013.  We excluded years 2014 and 2015 due
to delays in indexing of records that were observed.  In the extraction
process, we also limited the records to only those classified as "journal
articles," thereby excluding other types of scholarly communications, such as
editorials, comments on articles, letters to the editor, book reviews, and
obituaries.   

Search results were saved and exported as plain text files in _generic
bibliographic format_. The article records contained meta-data, including (but
not limited to): article title, journal title, publication year, author
name(s), author affiliation(s), abstract, keywords, methodological
classification, funding source, location of study, subject groups, digital
object identifier (DOI), number of references, number of pages, etc. It should
be noted that the databases provided different pieces of meta-data, or
meta-data in varying formats.  Thus, extensive post-process of the article
records was necessary to make the article records comparable and analyzable.  

## Post-processing of article records

Articles were post-processed from the _generic bibliographic format_ to a
structured database with computer scripts authored specifically for this study
using the programming language R. Post-processing of the files involved
addressing numerous problems that occurred during the original indexing of the
article records.  For example, journal titles that included the word ``and''
sometimes used an amersand (&). Other examples included inconsistent use of the
word ``The'' at the beginning of the title, or the inconsistent use of
subtitles.  It should be noted that some journals changed titles over their
publication history.  For example,  _Journal of Technology in Human Services_
is formerly known as _Computers in Human Services_.  All historical titles were
merged with their current titles and analyzed as a single journal in this
study. The source code provides complete details of all the procedures to
resolve discrepancies and historical titles.  

In addition to the foregoing date quality problem, a variety of other problems were identified and resolved.    For example, the filtering of article
records did not successfully exclude all other types of documents (e.g.,
editorials, book reviews, and obituaries).  Thus, we used a set of text
matching procedures called _regular expressions_ to identify other documents
that were incorrectly classified as journal articles.  We observed > 95%
accuracy identifying non-article records using a separate database designed
specifically for script testing.  We excluded article records if they were
missing essential meta-data for this study, including author name(s), journal
title, article title, and year of publication.  Finally, we eliminated all
social work journals with total article counts of < 10 for the entire 25 year
window (_Issues in Social Work Education_, _Pediatric Social Work_, and
_Critical Social Work_). 
 

## Analytic strategy

We conducted a series of descriptive analyses using various types of analyses and meta-data to demonstrate the utility of the database. Our first set of analyses focused on describing the overall _amount_ and _growth_ of social work research by summarizing the number of unique journal titles and articles published each year throughout the 25-year time frame.  We then disaggregated these data by examining the number of articles published by each journal.  We also performed an additional check on the quality of the data by making systematic comparisons with aggregate publication data from Scopus. Scopus data was selected because it is
the single largest abstract and citation database of scientific journals and
was not linked to either the EbscoHost or ProQuest databases in the record
extraction process.  

After describing the _amount_ and _growth_ of social work research, we conducted
a series of analyses to test the utility of using meta=data to reveal
publication trends.  As an indicator of the growth of _team science_ we
summarize counts of the number of authors per article over time.  And, in light 
of the shift from print to electronic articles, we examined whether the length 
of articles have changed during this 25-year time frame. Finally, we demonstrate the use of full-text abstracts as the basis for topical trend analysis.  For purposes of demonstration, we use the concept of "evidence-based practices" (and related concepts) to show changes in topics and areas of foci in the social work research.  


## Reproducible research

In addition to post-processing original article records, R was also used for
all other data analysis.  R is an ideal analytic tool because it is
open-source and has a suite of related tools for producing reproducible
research.  More specifically, all the source code is written using Rmarkdown --
an open-source system that integrates data management, data analysis, and the
written report.  The source code and data extracts are also curated at openICPSR
of the Inter-university Consotrium for Political and Social Research of the
University of Michigan.  The source code is also available from the first
author's GitHub repository, where the code will be maintained and updated to
support future research projects. It should be noted that the full data files
cannot be made publicly available because these are considered proprietary data
of the database services.  However, to ensure full compliance with the best
practices of reproducible research (cite King), we have provided the journal editor with the following conditions under which we would release the data: (1) the requester must be affilitated with an insitution that provides access to both the EbscoHost and ProQuest platforms along with the databases used in this study or (2) hold a personal subscription to each platform and the databases utilized here.  This is designed to meet the standards of maximum allowable data transparency while respecting the proprietary nature of the data.

# Results
```{r}
# As shown in Table 1, `r nrow(final.list.25)` journals were included in the current study.  The mean number of years of inclusion is `r options(digits=2); mean(final.list.updated$study.time)` (median = `r options(digits=2); median(final.list.updated$study.time);`, sd =  `r options(digits=2); sd(final.list.updated$study.time)`). The overall h-Index for each journal.  The h-Index values represent the current h-Index of each journal, as opposed to the h-Index of the final study period, so these values should be interpreted cautiously.  The mean h-Index value is XXXX, (median = XXX; sd = XXX). A total of `r pretty(sum(articles.year.df$year.count))` article records were obtained across these journals.  The average number of articles per journal was `r options(digits=2); pretty(mean(articles.year.df$year.count))` (median = `r options(digits=2); pretty(median(articles.year.df$year.count))`, sd = `r options(digits=2); pretty(sd(articles.year.df$year.count))`). This figure shows consistent growth in the number of articles from 1989 to 2005.  Notable fluctuations in the number of articles was observed from 2005 to 2008, followed by growth until 2012. The decline from 2012 to 2013 should be interpreted cautiously, as this may be an artifact due to delays in indexing.  
```

### Aggregated summary (Figure 1a. 1b. -- line charts) 

Figures 1a and 1b are line charts showing the number of unique journal
titles and journal articles published each year during the study time frame.
In 1989, XX unique journals published a XX articles.  The number of journal
titles showed some variability from 1989 to 1996, followed by nine years of
steady growth.  By 2005, the number of journal titles and journal articles
being published was more than double than what was observed in 1989. The years
2005 to 2013 exhibited some variability in the number of titles and articles
published.  The maximum number of journal titles was observed in 2011 (n = XX)
and dropped to XX by 2013.  The maximum number of journal articles published
was in 2012, and this dropped to XX in 2013.  The cumulative number of journal
articles published over the study time frame was XX,XXX.     





### Dis-aggregated summary (Figure 2. Small multiples)
 
Figure 2 is a small multiples plot, also referred to as a trellis or lattice
chart, that dis-aggregates Figures 1a and 1b.  More specifically, the small
multiples plot shows the number of articles published each year for each 
journal throughout the study time frame (orange line).  We also included data from Scopus for
comparative purposes (purple line).  The small multiples are sorted in descending
order based on the total number of article records in the HD.  The presentation
of the sort is by row, so the overall plot is read from left to right.
Abbreviations are used in Figure 2, and the full journal name is presented in
Appendix A.   

The small multiples plot is particularly useful to show the variability in
publishing for each journal.  In fact, according to Tufte (xxxx), small
multiples are the best design solution for visually enforcing comparisons of
change.  The plot shows that _Families in Society_, _Social Work_, and _British
Journal of Social Work_ published the greatest number of articles throughout
the study time frame.  However, the number of articles published by _Families
in Society_ and _Social Work_ appear to be decreasing, while other journals
show an increase -- e.g., _Research on Social Work Practice_, _International
Social Work_, and _Journal of Human Behavior and the Social Environment_.   

Data from Scopus was used to help show the overall coverage of the HD, in
addition to revealing possible gaps in indexing.  The HD and Scopus plotted
values do not show exact alignment for a couple reasons.  More specifically,
the HD contains article records going back to 1989, whereas Scopus provides
data starting from 1996.  Additionally, the overall journal coverage of HD is
much greater than Scopus -- that is, Scopus provides data for only xx% of the
journal titles contained in the HD.  

The Scopus data that are available show a high degree of correspondence with
the HD.  Small discrepancies between the Scopus and HD can be attributed to
differences in indexing.  That is, the article record count of Scopus includes
editorials and book reviews, whereas these were excluded from the HD.  In the
construction of the HD, we applied a series of cleaning procedures (refer to
Methods section) that further reduced the article count.  Because Scopus data
were available only in aggregate form, it was not possible to extract these
data to make more refined comparisons.  

And, finally, the small multiples plot is especially useful for identifying
potential gaps in indexing, which is a problem that has been previously
identified with respect to social work journals (see Holden; Holden). For
example, Scopus appears to be missing article records for the _Journal of
Gerontological Social Work_ from XX to XX.  And, the HD is missing records for
various journals including (but not limited to) the _Journal of Ethnic and
Cultural Diversity in Social Work_, _Journal of Social Work Disability &
Rehabilitation_.


### Article attributes

Figures 3a and 3b provide summaries of two important article attributes -- that
is, the number of authors per article and the length of each article.
Throughout the history of social work research, at least half of all social
work articles were sole authored until 2008, as indicated by the median value
in Figure 3a.  Since 2008, at least half of all articles had two authors.
Throughout the study time frame, the number of authors has increased steadily,
as shown by the increasing mean value and its standard deviation.  In 2013, the
mean number of authors was approximately 2.25, with a standard deviation of
1.4.  The length of the articles increased steadily from approximately 12 pages
in 1989 to 15 pages in 2004.  The last three years of the study time frame
shows a fairly stable publishing trend, with half of all articles being 15
pages (Mean = XX, sd = XX).   

### Abstract analysis

The final set of analyses involved text analysis of the article abstracts to
determine whether trends in publishing could be readily identified based on the
frequencies of specific words contained in article abstracts.  In this analysis, we selected words that
represented different _levels of evidence_ within the evidence-based practices
framework.  EBP was selected as the focus of analysis, given that the topic
area is a relatively new in social work, compared to other topics like child
welfare and case management.  Moreover, because EBP has received considerable
attention in various areas of social work research, it was expected that
the different _levels of evidence_ would show should both absolute and
relative changes in their occurrences. 

In this analysis, we focused on four different _levels of evidence_:
Meta-analysis, systematic reviews, randomized controlled trials (RCTs), and
quasi-experimental designs.  To identify these key words in the article
abstracts, we created a set of regular expressions of common spellings and
synonyms for each type of evidence (see Appendix B).  Regular expressions, also
referred to as regex and regexp, are sequences of characters that define
specific patterns in text documents and work much like the _find_ functions
common to word processors.  The regular expressions used to define the _levels
of evidence_ are presented in Appendix B and the study's source code.   

A stacked line chart was used to show absolute change in the number of
occurrences for each level of evidence in article abstracts.  The line chart
shows increased numbers of occurrences for each level of evidence, with the
greatest amount of growth starting in year 2008.  The presence of systematic
reviews and meta-analyses did not have a sustained presence in  the literature
until approximately 1995.  In fact, the first occurrence of the key word
_systematic review_ did not appear until 1997 (cite). 

To show relative change, we plotted the proportion of overall articles
published that contained the target key words for each year.  In 1989, RCTs and
Quasi-experimental studies were observed in approximately 1/2% of published
articles.  By 2013, the percentage of RCTs tripled and the percentage of
quasi-experimental doubled.  Meta-analyses appeared in 1989 and grew to almost
1/2% by 2013.  Systematic reviews first appeared in 1997, then again in 2003,
and grew to approximately 1% in 2013.   

**Pareto chart**



\newpage

```{r finalArticleListecho=FALSE, comment=NA}
#print.data.frame(final.list, row.names=FALSE)
```

\newpage

```{r}
#plotIndex
```

\newpage

```{r}
grid.arrange(plot.journal.count, plot.article.count, ncol=2)

```
\newpage
```{r fig.height=10, fig.width=7.5}
plotSmallMultiples.1

```

\newpage
```{r fig.height=10, fig.width=7.5}
plotSmallMultiples.2

```




\newpage


```{r}

grid.arrange(plot.author.count, page.plot, ncol = 2)
```

\newpage

```{r}
evidence.plot
```
\newpage

```{r}
stacked.plot
```


\newpage
```{r}
grid.arrange(journal.evidence.plot, propPlot, 
        ncol=2, nrow=1, widths=c(2, 1), heights=c(1.4, 4))
```


\newpage

# Appendix A

Articles on Hodge and Lacasse (2011) but not in the current study.  

```{r appendix_Print, eval=TRUE}
print(sort(hodge.swHistory.diff))
print(fewArticles)
```
