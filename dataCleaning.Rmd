---
title: "25 years of Social Work Research"
author: "Summary of Data Cleaning Procedures"
output: pdf_document
---

# Overview

This document summarizes data cleaning procedures of the data file processed by the `ebscoBWR` fucntion.  It should be noted that that `ebscoBWR` function merged the search results from the first- and second-level searches performed on the three databases (psycInfo, Social Science Abstracts, and Social Work Abstract) hosted by the EbscoPlatform.  This function merged all the search results, transformed the data into a structured data file, and removed all duplicate article records.  No further transformations or cleaning was performed by the `ebscoBWR` function.  Provided below are basic descriptive summaries of the results from the full search before further cleaning.  

The main file for analysis is `fullDF.R`, and a separate file is just for psycInfo `psycInfoDF.R`.  The same cleaning procedures need to be performed on both data files prior to analysis.  


# Initialization of workspace

```{r initialization_dataprocessing, warning=FALSE, message=FALSE, eval=TRUE}
# Clear workspace
rm(list=ls())   

# Load required packages
library(ggplot2)
library(dplyr)

# Read data files

load("/Users/beperron/Git/SocialWorkResearch/Data/ebscoFULL.R")
load("/Users/beperron/Git/SocialWorkResearch/Data/proQuest.R")
load("/Users/beperron/Git/SocialWorkResearch/Data/ebscoPsycInfo.R")

#load("/Users/SSW/Documents/GitHub/SocialWork100Years/Data/ebscoFULL.R")
#load("/Users/SSW/Documents/GitHub/SocialWork100Years/Data/proQuest.R")
#load("/Users/SSW/Documents/GitHub/SocialWork100Years/Data/ebscoPsycInfo.R")

```



# Combines EbscoHost and ProQUest 

This section ... wrangles and eliminates duplicate article titles

```{r appendData, comment=NA}

#Creates variable with highest article ID from ebscohost database
ebscoIDmax<-max(ebscoBWR.df$articleID)

#Recodes article ID in ProQuest database in advance of merger with ebscohost
proQuestBWR.df<-mutate(proQuestBWR.df, articleID=articleID+ebscoIDmax)

#Creates data frames that contain only article ID and titles from respective
#databases
ebscoTitles<-filter(ebscoBWR.df, attributes=="article")
proTitles<-filter(proQuestBWR.df, attributes=="article")

#Combines titles into single data frame
jointTitles<-rbind(ebscoTitles, proTitles)

#Forces article title text to lower case
jointTitles$record<-tolower(jointTitles$record)
  
#Strips out white space and punctuation to ensure small differences in data 
#entry are detected during duplicate elimination
jointTitles$record<-gsub(" ","", jointTitles$record)
  
jointTitles$record<-gsub("[[:punct:]]", "", jointTitles$record)

jointTitles<- jointTitles[duplicated(jointTitles$record), ]

#Screen out duplicated records by articleID. The articleID must be used
#because the duplicate title contains other article attributes
jointTitles.dup.ID <- jointTitles$articleID
  
#Combines EbscoHost and ProQuest Wrangles, and strips out article attributes 
#from duplicate entries
combined.DF<-rbind(ebscoBWR.df, proQuestBWR.df)
full.df<-combined.DF[!(combined.DF$articleID %in% jointTitles.dup.ID), ]  

rm(list=setdiff(ls(), "full.df"))

```

# Data cleaning and pre-processing

## Narrow results to past 25 years

Inspection of the data indicated notable delays in indexing for the years 2014 and 2015.  Therefore, these years were excluded from the current study.  Thus, this study includes journals indexed through the end of 2013.  

```{r}

year.25 <- as.character(c(1900:1987, 2014, 2015))
years <- c("2014", "2015")
#ebsco.remove <- full.df[full.df$record %in% years, ]
ebsco.remove <- full.df[full.df$record %in% year.25, ]
ebsco.remove <- ebsco.remove[, "articleID"]
full.df <- full.df[!(full.df$articleID %in% ebsco.remove),]
```




## Initial descriptive summary


```{r preprocessing, comment=NA, echo=TRUE} 
number.of.articles <- length(which(full.df$attributes == "article"))
range.of.years <- range(full.df$record[full.df$attributes == "pubYear"])
```


```{r}
# Number of articles
cat(number.of.articles)
```

```{r}
# Range of years
cat(range.of.years)
```


## Exclusion of journals not meeting supplemental search terms

The search for journals involved a two-stage process.  It began by extracting all records from journals based on the social work journal list of Hodge and L (APA cite).  Journals were excluded if they did not contain one of the major search terms from the supplemental list.  The majority of these journals were captured in the supplemental search query because the journal used one of the supplemental search terms in a special issue.  The mission and scope of journals were also reviewed when it was unclear whether the journal was specific to social work research (e.g., _The Clinical Supervisor_).  The supplemental search terms included:

+ social work
+ social welfare
+ social casework (or social case work)
+ social service
+ human service
+ social development 
+ social environment


```{r exclusion1, eval=TRUE}
exclusions.1 <- c(
    "American Journal of Preventive Medicine", 
    "Behavior Modification", 
    "Brain and Cognition",
    "Canadian Journal of Community Mental Health",
    "Canadian Journal on Aging",
    "Early Child Development and Care",
    "Early Education and Development",
    "Employee Assistance Quarterly",
    "Evaluation and Program Planning",
    "General Hospital Psychiatry",
    "International Review of Social Research",
    "Journal of Applied Behavioral Science",
    "Journal of Applied Rehabilitation Counseling",
    "Journal of Community & Applied Social Psychology",
    "Journal of Health & Human Services Administration",
    "Journal of Nonverbal Behavior",
    "Journal of Psychosomatic Research",
    "Learning Disabilities Research & Practice",
    "Professional Development in Education",
    "PROFILE Issues in Teachers' Professional Development",
    "Psychotherapy",
    "Systems Research and Behavioral Science",
    "Teaching and Teacher Education",
    "The Scientific Review of Mental Health Practice",
    "The Clinical Supervisor")

ebsco.remove <- full.df[full.df$record %in% exclusions.1, ]
ebsco.remove <- ebsco.remove[, "articleID"]
full.df <- full.df[!(full.df$articleID %in% ebsco.remove),]

rm(ebsco.remove)
```



## Exclusions of social work publications
 
+ Journals that did not have at least one full year of indexed records (except journals that subsequently changed titles).  This exclusionary criterion was consistent with the working definition of a social work journal.  

```{r exclusion2, eval=TRUE}
exclusions.2 <- c(
    "Issues in Social Work Education", 
    "Maatskaplike Werk/Social Work",
    "Pediatric Social Work", 
    "Critical Social Work"
    )

ebsco.remove <- full.df[full.df$record %in% exclusions.2, ]
ebsco.remove <- ebsco.remove[, "articleID"]
full.df <- full.df[!(full.df$articleID %in% ebsco.remove),]

rm(ebsco.remove, exclusions.2)
```


## Fix journal titles  

Additional pre-processing was conducted on journal titles to resolve spelling errors or other minor title differences in the database. For example, _Social Work With Groups_ was exported as a separate journal than _Social Work with Groups_ (note the capitalization difference in the word _with_.)  We also applied a global substitution of _and_ with _&_, as this was a common source for differences.  

```{r echo=FALSE}
full.df$record <- ifelse(full.df$record == 
        "Social Work & Social Sciences Review",     # Spelling difference
        "Social Work and Social Sciences Review", 
                        full.df$record)

full.df$record <- ifelse(full.df$record == 
        "Social Work with Groups",                  # Spelling difference
        "Social Work With Groups", 
                        full.df$record)

full.df$record <- ifelse(full.df$record == 
        "Journal of Sociology & Social Welfare",    # Spelling difference
        "Journal of Sociology and Social Welfare",  
                        full.df$record)

full.df$record <- ifelse(full.df$record == 
    "The British Journal Social Work",          # Spelling difference
        "British Journal of Social Work",           
                        full.df$record)

#shortens Professional Development
full.df$record <- ifelse(full.df$attributes == "journal",
        gsub(":.+", "", full.df$record), 
        full.df$record)

#shortens Canadian Social Work review by eliminating foreign title and is
#automatically combined with other short spelling
full.df$record <- ifelse(full.df$attributes == "journal",
        gsub("(/R){1}.+", "", full.df$record), 
        full.df$record)

# shortens Contemporary Rural Social Work
full.df$record <- ifelse(full.df$attributes == "journal",
        gsub("\\s\\(.+", "", full.df$record), 
        full.df$record)

full.df$record <- ifelse(full.df$attributes == "journal", 
      gsub("and", "&", full.df$record), full.df$record)

```

```{r date, echo=FALSE, comment=NA}
unique.titles <- filter(full.df, attributes == "journal") %>%
    group_by(record) %>%
    summarise(
        N = n())
print.data.frame(unique.titles, rowNames=FALSE)
```


## Title merging

Some social work journals changed titles over their history.  For example, _Families in Society_ had three titles that preceded the current title:  _Social Casework_, _Journal of Social Casework_, and _The Family_.  The database that contributed the largest number of articles to the study database indexed the majority of journal titles under the journal's current name, and provided an additional data field for the historical name.  However, historical names from Social Science Abstracts and Social Work Abstracts were not merged with the current name.  Thus, the last step of the data cleaning procedures was to conduct these merges.  

```{r titleMerge, eval=TRUE}
full.df$record <- ifelse(full.df$record == 
    "The British Journal of Pyschiatric Social Work" | 
        full.df$record == 
    "The British Journal of Social Work", # Old
        "British Journal of Social Work",           # New title
                        full.df$record)

full.df$record <- ifelse(full.df$record == 
        "Computers in Human Services",              # Old title
        "Journal of Technology in Human Services",  # New title
                        full.df$record)


full.df$record <- ifelse(full.df$record == 
        "The Family" | full.df$record ==                    # Old title
        "Journal of Social Casework" | full.df$record ==    # Old title
        "Social Casework",                                  # Old title
        "Families in Society",                              # New title
                        full.df$record)

full.df$record <- ifelse(full.df$record == 
        "Social Work in Education",                 # Old title
        "Children & Schools",                       # New title
                    full.df$record)

full.df$record <- ifelse(full.df$record == 
        "Journal of Independent Social Work" | full.df$record ==    # New title
        "Journal of Analytic Social Work",                          # Old title
        "Psychoanalytic Social Work",                               # Old title
                full.df$record)

# Journals were originally merged after suffixes were eliminated (after the
# colon).  Thus, Practice: Social Work in Action  (new title) was shortened to
# Practice (old title).  This section resolves two of these issues to be
# consistent in the comparison with Hodge.

practice.temp <- grep("^Practice$", full.df$record)
full.df$record[practice.temp] <- "Practice: Social Work in Action"

practice.temp <- grep("^Reflections$", full.df$record)
full.df$record[practice.temp] <- "Reflections: Narratives of Professional Helping"
```


# Post-processing summary 

## Revised database

This section provides a summary of the revised database after the initial processing with the `ebscoBWR` function and the subsequent data cleaning.  An additional code is included in this summary to indicate whether the journal title overlaps with the list of Hodge (indicated by *H*).  

```{r echo=FALSE, comment=NA}
unique.titles <- filter(full.df, attributes == "journal") %>%
    group_by(record) %>%
    summarise(N = n())

hodge <- readLines("/Users/beperron/Git/SocialWorkResearch/search_specifications/hodge.txt", n = -1)

unique.titles <- filter(full.df, attributes == "journal") %>%
    group_by(record) %>%
    mutate(Hodge.list = ifelse(record %in% hodge == TRUE, 1, 0)) %>%
    summarise(N = n(), 
              Hodge.list = max(Hodge.list)) %>%
    mutate(Hodge = ifelse(Hodge.list == 1, "Y", "N"))


n.so.yr <- filter(full.df, attributes == "journal" | attributes == "pubYear")

n.so <- filter(full.df, attributes == "journal") %>% mutate(title = record) %>% 
        select(-attributes, -record)

n.yr <- filter(full.df, attributes == "pubYear") %>% mutate(year = record ) %>% 
        select(-attributes, -record)

n.so.yr <- left_join(n.so, n.yr) %>%
    group_by(title) %>%
    summarise(first = min(year), last = max(year), n = n()) %>%
    arrange(title)

H <- unique.titles$Hodge

final.list <- cbind(n.so.yr, H)

print.data.frame(final.list, row.names=FALSE)
```




# Comparison with Hodge 

This section provides further comparison of the journal titles with Hodge by reporting on the _intersection_, and _differences_.


## Intersection


This list shows which journal titles are common to both lists.

```{r}
hodge <- readLines("/Users/beperron/Git/SocialWorkResearch/search_specifications/hodge.txt", n = -1)

unique.swHistory <- filter(full.df, attributes == "journal") %>%
                distinct(record)

hodge.swHistory.intersect <- intersect(hodge, unique.swHistory$record)

hodge.swHistory.diff <- setdiff(hodge, unique.swHistory$record)
swHistory.hodge.diff <- setdiff(unique.swHistory$record, hodge)

#hodge.swHistory.union <- union(hodge, unique.swHistory$record)
```


```{r}
print(sort(hodge.swHistory.intersect))
```

## Differences

This list shows the articles on Hodge but not the current study.  

```{r}
print(sort(hodge.swHistory.diff))
```
This list shows the articles on the current study but not on Hodge.

```{r}
print(sort(swHistory.hodge.diff))
```



## Descriptive summary of records

```{r comment=NA, echo=TRUE} 
number.of.articles <- length(which(full.df$attributes == "article"))
range.of.years <- range(full.df$record[full.df$attributes == "pubYear"])
```


```{r}
# Number of articles
cat(number.of.articles)
```

```{r}
# Range of years
cat(range.of.years)
```

```{r}
cor.data <- select(final.list, first, last, n) %>%
            mutate(no.years = as.numeric(last) - as.numeric(first)) 

ggplot(cor.data, aes(x = no.years, y = n)) + 
            geom_point(shape = 1) + 
            geom_smooth() + 
            xlab("Years") + 
            ylab("Number of articles")

cor(cor.data$no.years, cor.data$n)
```